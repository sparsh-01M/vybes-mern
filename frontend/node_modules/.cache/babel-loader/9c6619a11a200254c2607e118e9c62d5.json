{"ast":null,"code":"var _jsxFileName = \"/Users/sparshsinghal/Downloads/vybes-mern-main/frontend/src/components/AIBot.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport './AIBot.css';\nimport { toast } from 'react-toastify';\nimport ReactMarkdown from 'react-markdown';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SUGGESTED_QUESTIONS = [\"What are the best practices for learning a new programming language?\", \"How can I improve my productivity while coding?\", \"Explain the concept of machine learning in simple terms\", \"What are the latest trends in web development?\", \"How can I start learning artificial intelligence?\"]; // Function to format text with proper styling\n\nconst formatMessage = text => {\n  // Replace markdown-style formatting with HTML\n  let formattedText = text // Bold text\n  .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>') // Italic text\n  .replace(/\\*(.*?)\\*/g, '<em>$1</em>') // Code blocks\n  .replace(/```([\\s\\S]*?)```/g, '<pre><code>$1</code></pre>') // Inline code\n  .replace(/`([^`]+)`/g, '<code>$1</code>') // Lists\n  .replace(/^\\s*[-*+]\\s+(.+)$/gm, '<li>$1</li>') // Headers\n  .replace(/^### (.*$)/gm, '<h3>$1</h3>').replace(/^## (.*$)/gm, '<h2>$1</h2>').replace(/^# (.*$)/gm, '<h1>$1</h1>') // Links\n  .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>');\n  return formattedText;\n}; // Component for rendering formatted message content\n\n\nconst MessageContent = _ref => {\n  let {\n    content\n  } = _ref;\n  const formattedContent = formatMessage(content);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message-content-wrapper\",\n    children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n      components: {\n        // Style different elements\n        p: _ref2 => {\n          let {\n            children\n          } = _ref2;\n          return /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"message-paragraph\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 48,\n            columnNumber: 32\n          }, this);\n        },\n        strong: _ref3 => {\n          let {\n            children\n          } = _ref3;\n          return /*#__PURE__*/_jsxDEV(\"strong\", {\n            className: \"message-bold\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 49,\n            columnNumber: 37\n          }, this);\n        },\n        em: _ref4 => {\n          let {\n            children\n          } = _ref4;\n          return /*#__PURE__*/_jsxDEV(\"em\", {\n            className: \"message-italic\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 50,\n            columnNumber: 33\n          }, this);\n        },\n        code: _ref5 => {\n          let {\n            children,\n            inline\n          } = _ref5;\n          return inline ? /*#__PURE__*/_jsxDEV(\"code\", {\n            className: \"message-inline-code\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 53,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"pre\", {\n            className: \"message-code-block\",\n            children: /*#__PURE__*/_jsxDEV(\"code\", {\n              children: children\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 54,\n              columnNumber: 51\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 54,\n            columnNumber: 15\n          }, this);\n        },\n        ul: _ref6 => {\n          let {\n            children\n          } = _ref6;\n          return /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"message-list\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 33\n          }, this);\n        },\n        ol: _ref7 => {\n          let {\n            children\n          } = _ref7;\n          return /*#__PURE__*/_jsxDEV(\"ol\", {\n            className: \"message-list\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 56,\n            columnNumber: 33\n          }, this);\n        },\n        li: _ref8 => {\n          let {\n            children\n          } = _ref8;\n          return /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"message-list-item\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 57,\n            columnNumber: 33\n          }, this);\n        },\n        h1: _ref9 => {\n          let {\n            children\n          } = _ref9;\n          return /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"message-heading message-h1\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 58,\n            columnNumber: 33\n          }, this);\n        },\n        h2: _ref10 => {\n          let {\n            children\n          } = _ref10;\n          return /*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"message-heading message-h2\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 59,\n            columnNumber: 33\n          }, this);\n        },\n        h3: _ref11 => {\n          let {\n            children\n          } = _ref11;\n          return /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"message-heading message-h3\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 60,\n            columnNumber: 33\n          }, this);\n        },\n        a: _ref12 => {\n          let {\n            href,\n            children\n          } = _ref12;\n          return /*#__PURE__*/_jsxDEV(\"a\", {\n            href: href,\n            className: \"message-link\",\n            target: \"_blank\",\n            rel: \"noopener noreferrer\",\n            children: children\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 62,\n            columnNumber: 13\n          }, this);\n        }\n      },\n      children: content\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 44,\n    columnNumber: 5\n  }, this);\n};\n\n_c = MessageContent;\nexport default function AIBot() {\n  _s();\n\n  const navigate = useNavigate();\n  const [chats, setChats] = useState([]);\n  const [currentChat, setCurrentChat] = useState(null);\n  const [message, setMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const messagesEndRef = useRef(null);\n  const userId = localStorage.getItem('userId') || 'anonymous';\n  const [editingChatId, setEditingChatId] = useState(null);\n  const [editingTitle, setEditingTitle] = useState('');\n  const editInputRef = useRef(null); // Fetch user's chat history\n\n  useEffect(() => {\n    fetchChats();\n  }, []);\n\n  const fetchChats = async () => {\n    try {\n      console.log('Fetching chats for userId:', userId);\n      const response = await fetch(`http://localhost:4000/chats/${userId}`);\n      console.log('Response status:', response.status);\n\n      if (!response.ok) {\n        const errorData = await response.text();\n        console.error('Error response:', errorData);\n        throw new Error(`Failed to fetch chats: ${response.status} ${errorData}`);\n      }\n\n      const data = await response.json();\n      console.log('Received chats data:', data);\n      setChats(data);\n    } catch (err) {\n      console.error('Detailed error fetching chats:', err);\n      toast.error(err.message || 'Failed to load chat history');\n    }\n  };\n\n  const fetchChat = async chatId => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}`);\n      if (!response.ok) throw new Error('Failed to fetch chat');\n      const data = await response.json();\n      setCurrentChat(data);\n    } catch (err) {\n      console.error('Error fetching chat:', err);\n      toast.error('Failed to load chat');\n    }\n  };\n\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [currentChat === null || currentChat === void 0 ? void 0 : currentChat.messages]);\n\n  const handleNewChat = async () => {\n    setCurrentChat(null);\n    setMessage('');\n  };\n\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!message.trim()) return;\n    console.log('Sending message:', message);\n    setLoading(true);\n\n    try {\n      const url = currentChat ? `http://localhost:4000/chat/${currentChat._id}/message` : 'http://localhost:4000/chat';\n      console.log('Sending request to:', url);\n      console.log('Request payload:', {\n        userId,\n        message: message.trim()\n      });\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          userId,\n          message: message.trim()\n        })\n      });\n      console.log('Response status:', response.status);\n\n      if (!response.ok) {\n        const errorData = await response.text();\n        console.error('Error response:', errorData);\n        throw new Error(`Failed to send message: ${response.status} ${errorData}`);\n      }\n\n      const data = await response.json();\n      console.log('Received chat data:', data);\n      setCurrentChat(data);\n\n      if (!currentChat) {\n        console.log('Fetching updated chat list...');\n        fetchChats();\n      }\n\n      setMessage('');\n    } catch (err) {\n      console.error('Detailed error sending message:', err);\n      toast.error(err.message || 'Failed to send message');\n    } finally {\n      setLoading(false);\n    }\n  }; // Add useEffect to log component state changes\n\n\n  useEffect(() => {\n    console.log('Current chat state:', currentChat);\n    console.log('Current message state:', message);\n    console.log('Current loading state:', loading);\n  }, [currentChat, message, loading]);\n\n  const handleDeleteChat = async chatId => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}`, {\n        method: 'DELETE'\n      });\n      if (!response.ok) throw new Error('Failed to delete chat');\n\n      if ((currentChat === null || currentChat === void 0 ? void 0 : currentChat._id) === chatId) {\n        setCurrentChat(null);\n      }\n\n      fetchChats();\n      toast.success('Chat deleted successfully');\n    } catch (err) {\n      console.error('Error deleting chat:', err);\n      toast.error('Failed to delete chat');\n    }\n  };\n\n  const formatDate = dateString => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleRenameChat = async (chatId, newTitle) => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}/rename`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          title: newTitle\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to rename chat');\n      }\n\n      const updatedChat = await response.json(); // Update the chats list\n\n      setChats(chats.map(chat => chat._id === chatId ? { ...chat,\n        title: updatedChat.title\n      } : chat)); // Update current chat if it's the one being renamed\n\n      if ((currentChat === null || currentChat === void 0 ? void 0 : currentChat._id) === chatId) {\n        setCurrentChat(updatedChat);\n      }\n\n      setEditingChatId(null);\n      setEditingTitle('');\n      toast.success('Chat renamed successfully');\n    } catch (err) {\n      console.error('Error renaming chat:', err);\n      toast.error('Failed to rename chat');\n    }\n  };\n\n  const startEditing = chat => {\n    setEditingChatId(chat._id);\n    setEditingTitle(chat.title); // Focus the input after it's rendered\n\n    setTimeout(() => {\n      var _editInputRef$current;\n\n      (_editInputRef$current = editInputRef.current) === null || _editInputRef$current === void 0 ? void 0 : _editInputRef$current.focus();\n    }, 0);\n  };\n\n  const handleKeyPress = (e, chatId) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleRenameChat(chatId, editingTitle);\n    } else if (e.key === 'Escape') {\n      setEditingChatId(null);\n      setEditingTitle('');\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ai-bot-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ai-bot-sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"new-chat-button\",\n        onClick: handleNewChat,\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"material-icons\",\n          children: \"add\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 11\n        }, this), \"New Chat\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-history\",\n        children: chats && chats.length > 0 ? chats.map(chat => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `chat-item ${(currentChat === null || currentChat === void 0 ? void 0 : currentChat._id) === chat._id ? 'active' : ''}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-item-content\",\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"material-icons\",\n              children: \"chat\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 19\n            }, this), editingChatId === chat._id ? /*#__PURE__*/_jsxDEV(\"input\", {\n              ref: editInputRef,\n              type: \"text\",\n              value: editingTitle,\n              onChange: e => setEditingTitle(e.target.value),\n              onKeyDown: e => handleKeyPress(e, chat._id),\n              onBlur: () => handleRenameChat(chat._id, editingTitle),\n              className: \"chat-title-edit\",\n              onClick: e => e.stopPropagation()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 21\n            }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"chat-title\",\n              onClick: () => fetchChat(chat._id),\n              children: chat.title\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"chat-date\",\n              children: formatDate(chat.updatedAt)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"rename-chat-button\",\n              onClick: e => {\n                e.stopPropagation();\n                startEditing(chat);\n              },\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"material-icons\",\n                children: \"edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 330,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 323,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"delete-chat-button\",\n              onClick: e => {\n                e.stopPropagation();\n                handleDeleteChat(chat._id);\n              },\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"material-icons\",\n                children: \"delete\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 339,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 17\n          }, this)]\n        }, chat._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 15\n        }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-chats-message\",\n          children: \"No previous chats\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ai-bot-main\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-container\",\n        children: [!currentChat ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"welcome-screen\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"Welcome to AI Assistant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Start a new conversation or select a previous chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"suggested-questions\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Suggested Questions\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 357,\n              columnNumber: 17\n            }, this), SUGGESTED_QUESTIONS.map((question, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"suggested-question\",\n              onClick: () => {\n                setMessage(question);\n                handleSendMessage({\n                  preventDefault: () => {}\n                });\n              },\n              children: question\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 359,\n              columnNumber: 19\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"messages-container\",\n          children: [currentChat.messages.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `message ${msg.role === 'user' ? 'user-message' : 'assistant-message'}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-content\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-header\",\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"material-icons\",\n                  children: msg.role === 'user' ? 'person' : 'smart_toy'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 381,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: msg.role === 'user' ? 'You' : 'AI Assistant'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 384,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 380,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(MessageContent, {\n                content: msg.content\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 19\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 17\n          }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n            ref: messagesEndRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 390,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSendMessage,\n          className: \"message-input-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: message,\n            onChange: e => setMessage(e.target.value),\n            placeholder: \"Type your message...\",\n            disabled: loading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: loading || !message.trim(),\n            children: loading ? /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"material-icons rotating\",\n              children: \"refresh\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 404,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"material-icons\",\n              children: \"send\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 286,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AIBot, \"t11P011Ct/YmCTKrsP1XTvpC6ZY=\", false, function () {\n  return [useNavigate];\n});\n\n_c2 = AIBot;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"MessageContent\");\n$RefreshReg$(_c2, \"AIBot\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","toast","ReactMarkdown","SUGGESTED_QUESTIONS","formatMessage","text","formattedText","replace","MessageContent","content","formattedContent","p","children","strong","em","code","inline","ul","ol","li","h1","h2","h3","a","href","AIBot","navigate","chats","setChats","currentChat","setCurrentChat","message","setMessage","loading","setLoading","messagesEndRef","userId","localStorage","getItem","editingChatId","setEditingChatId","editingTitle","setEditingTitle","editInputRef","fetchChats","console","log","response","fetch","status","ok","errorData","error","Error","data","json","err","fetchChat","chatId","scrollToBottom","current","scrollIntoView","behavior","messages","handleNewChat","handleSendMessage","e","preventDefault","trim","url","_id","method","headers","body","JSON","stringify","handleDeleteChat","success","formatDate","dateString","Date","toLocaleDateString","month","day","hour","minute","handleRenameChat","newTitle","title","updatedChat","map","chat","startEditing","setTimeout","focus","handleKeyPress","key","length","target","value","stopPropagation","updatedAt","question","index","msg","role"],"sources":["/Users/sparshsinghal/Downloads/vybes-mern-main/frontend/src/components/AIBot.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport './AIBot.css';\nimport { toast } from 'react-toastify';\nimport ReactMarkdown from 'react-markdown';\n\nconst SUGGESTED_QUESTIONS = [\n  \"What are the best practices for learning a new programming language?\",\n  \"How can I improve my productivity while coding?\",\n  \"Explain the concept of machine learning in simple terms\",\n  \"What are the latest trends in web development?\",\n  \"How can I start learning artificial intelligence?\"\n];\n\n// Function to format text with proper styling\nconst formatMessage = (text) => {\n  // Replace markdown-style formatting with HTML\n  let formattedText = text\n    // Bold text\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    // Italic text\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    // Code blocks\n    .replace(/```([\\s\\S]*?)```/g, '<pre><code>$1</code></pre>')\n    // Inline code\n    .replace(/`([^`]+)`/g, '<code>$1</code>')\n    // Lists\n    .replace(/^\\s*[-*+]\\s+(.+)$/gm, '<li>$1</li>')\n    // Headers\n    .replace(/^### (.*$)/gm, '<h3>$1</h3>')\n    .replace(/^## (.*$)/gm, '<h2>$1</h2>')\n    .replace(/^# (.*$)/gm, '<h1>$1</h1>')\n    // Links\n    .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>');\n\n  return formattedText;\n};\n\n// Component for rendering formatted message content\nconst MessageContent = ({ content }) => {\n  const formattedContent = formatMessage(content);\n  \n  return (\n    <div className=\"message-content-wrapper\">\n      <ReactMarkdown\n        components={{\n          // Style different elements\n          p: ({ children }) => <p className=\"message-paragraph\">{children}</p>,\n          strong: ({ children }) => <strong className=\"message-bold\">{children}</strong>,\n          em: ({ children }) => <em className=\"message-italic\">{children}</em>,\n          code: ({ children, inline }) => \n            inline ? \n              <code className=\"message-inline-code\">{children}</code> : \n              <pre className=\"message-code-block\"><code>{children}</code></pre>,\n          ul: ({ children }) => <ul className=\"message-list\">{children}</ul>,\n          ol: ({ children }) => <ol className=\"message-list\">{children}</ol>,\n          li: ({ children }) => <li className=\"message-list-item\">{children}</li>,\n          h1: ({ children }) => <h1 className=\"message-heading message-h1\">{children}</h1>,\n          h2: ({ children }) => <h2 className=\"message-heading message-h2\">{children}</h2>,\n          h3: ({ children }) => <h3 className=\"message-heading message-h3\">{children}</h3>,\n          a: ({ href, children }) => (\n            <a \n              href={href} \n              className=\"message-link\" \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n            >\n              {children}\n            </a>\n          ),\n        }}\n      >\n        {content}\n      </ReactMarkdown>\n    </div>\n  );\n};\n\nexport default function AIBot() {\n  const navigate = useNavigate();\n  const [chats, setChats] = useState([]);\n  const [currentChat, setCurrentChat] = useState(null);\n  const [message, setMessage] = useState('');\n  const [loading, setLoading] = useState(false);\n  const messagesEndRef = useRef(null);\n  const userId = localStorage.getItem('userId') || 'anonymous';\n  const [editingChatId, setEditingChatId] = useState(null);\n  const [editingTitle, setEditingTitle] = useState('');\n  const editInputRef = useRef(null);\n\n  // Fetch user's chat history\n  useEffect(() => {\n    fetchChats();\n  }, []);\n\n  const fetchChats = async () => {\n    try {\n      console.log('Fetching chats for userId:', userId);\n      const response = await fetch(`http://localhost:4000/chats/${userId}`);\n      console.log('Response status:', response.status);\n      \n      if (!response.ok) {\n        const errorData = await response.text();\n        console.error('Error response:', errorData);\n        throw new Error(`Failed to fetch chats: ${response.status} ${errorData}`);\n      }\n      \n      const data = await response.json();\n      console.log('Received chats data:', data);\n      setChats(data);\n    } catch (err) {\n      console.error('Detailed error fetching chats:', err);\n      toast.error(err.message || 'Failed to load chat history');\n    }\n  };\n\n  const fetchChat = async (chatId) => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}`);\n      if (!response.ok) throw new Error('Failed to fetch chat');\n      const data = await response.json();\n      setCurrentChat(data);\n    } catch (err) {\n      console.error('Error fetching chat:', err);\n      toast.error('Failed to load chat');\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [currentChat?.messages]);\n\n  const handleNewChat = async () => {\n    setCurrentChat(null);\n    setMessage('');\n  };\n\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    if (!message.trim()) return;\n\n    console.log('Sending message:', message);\n    setLoading(true);\n    try {\n      const url = currentChat \n        ? `http://localhost:4000/chat/${currentChat._id}/message`\n        : 'http://localhost:4000/chat';\n      \n      console.log('Sending request to:', url);\n      console.log('Request payload:', {\n        userId,\n        message: message.trim()\n      });\n\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: { \n          'Content-Type': 'application/json',\n          'Accept': 'application/json'\n        },\n        body: JSON.stringify({\n          userId,\n          message: message.trim()\n        })\n      });\n\n      console.log('Response status:', response.status);\n      \n      if (!response.ok) {\n        const errorData = await response.text();\n        console.error('Error response:', errorData);\n        throw new Error(`Failed to send message: ${response.status} ${errorData}`);\n      }\n      \n      const data = await response.json();\n      console.log('Received chat data:', data);\n      \n      setCurrentChat(data);\n      if (!currentChat) {\n        console.log('Fetching updated chat list...');\n        fetchChats();\n      }\n      setMessage('');\n    } catch (err) {\n      console.error('Detailed error sending message:', err);\n      toast.error(err.message || 'Failed to send message');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Add useEffect to log component state changes\n  useEffect(() => {\n    console.log('Current chat state:', currentChat);\n    console.log('Current message state:', message);\n    console.log('Current loading state:', loading);\n  }, [currentChat, message, loading]);\n\n  const handleDeleteChat = async (chatId) => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}`, {\n        method: 'DELETE'\n      });\n      \n      if (!response.ok) throw new Error('Failed to delete chat');\n      \n      if (currentChat?._id === chatId) {\n        setCurrentChat(null);\n      }\n      fetchChats();\n      toast.success('Chat deleted successfully');\n    } catch (err) {\n      console.error('Error deleting chat:', err);\n      toast.error('Failed to delete chat');\n    }\n  };\n\n  const formatDate = (dateString) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleRenameChat = async (chatId, newTitle) => {\n    try {\n      const response = await fetch(`http://localhost:4000/chat/${chatId}/rename`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ title: newTitle })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to rename chat');\n      }\n\n      const updatedChat = await response.json();\n      \n      // Update the chats list\n      setChats(chats.map(chat => \n        chat._id === chatId ? { ...chat, title: updatedChat.title } : chat\n      ));\n\n      // Update current chat if it's the one being renamed\n      if (currentChat?._id === chatId) {\n        setCurrentChat(updatedChat);\n      }\n\n      setEditingChatId(null);\n      setEditingTitle('');\n      toast.success('Chat renamed successfully');\n    } catch (err) {\n      console.error('Error renaming chat:', err);\n      toast.error('Failed to rename chat');\n    }\n  };\n\n  const startEditing = (chat) => {\n    setEditingChatId(chat._id);\n    setEditingTitle(chat.title);\n    // Focus the input after it's rendered\n    setTimeout(() => {\n      editInputRef.current?.focus();\n    }, 0);\n  };\n\n  const handleKeyPress = (e, chatId) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleRenameChat(chatId, editingTitle);\n    } else if (e.key === 'Escape') {\n      setEditingChatId(null);\n      setEditingTitle('');\n    }\n  };\n\n  return (\n    <div className=\"ai-bot-container\">\n      <div className=\"ai-bot-sidebar\">\n        <button className=\"new-chat-button\" onClick={handleNewChat}>\n          <i className=\"material-icons\">add</i>\n          New Chat\n        </button>\n        <div className=\"chat-history\">\n          {chats && chats.length > 0 ? (\n            chats.map(chat => (\n              <div \n                key={chat._id} \n                className={`chat-item ${currentChat?._id === chat._id ? 'active' : ''}`}\n              >\n                <div className=\"chat-item-content\">\n                  <i className=\"material-icons\">chat</i>\n                  {editingChatId === chat._id ? (\n                    <input\n                      ref={editInputRef}\n                      type=\"text\"\n                      value={editingTitle}\n                      onChange={(e) => setEditingTitle(e.target.value)}\n                      onKeyDown={(e) => handleKeyPress(e, chat._id)}\n                      onBlur={() => handleRenameChat(chat._id, editingTitle)}\n                      className=\"chat-title-edit\"\n                      onClick={(e) => e.stopPropagation()}\n                    />\n                  ) : (\n                    <span \n                      className=\"chat-title\"\n                      onClick={() => fetchChat(chat._id)}\n                    >\n                      {chat.title}\n                    </span>\n                  )}\n                  <span className=\"chat-date\">{formatDate(chat.updatedAt)}</span>\n                </div>\n                <div className=\"chat-actions\">\n                  <button \n                    className=\"rename-chat-button\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      startEditing(chat);\n                    }}\n                  >\n                    <i className=\"material-icons\">edit</i>\n                  </button>\n                  <button \n                    className=\"delete-chat-button\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleDeleteChat(chat._id);\n                    }}\n                  >\n                    <i className=\"material-icons\">delete</i>\n                  </button>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"no-chats-message\">No previous chats</div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"ai-bot-main\">\n        <div className=\"chat-container\">\n          {!currentChat ? (\n            <div className=\"welcome-screen\">\n              <h1>Welcome to AI Assistant</h1>\n              <p>Start a new conversation or select a previous chat</p>\n              <div className=\"suggested-questions\">\n                <h3>Suggested Questions</h3>\n                {SUGGESTED_QUESTIONS.map((question, index) => (\n                  <button\n                    key={index}\n                    className=\"suggested-question\"\n                    onClick={() => {\n                      setMessage(question);\n                      handleSendMessage({ preventDefault: () => {} });\n                    }}\n                  >\n                    {question}\n                  </button>\n                ))}\n              </div>\n            </div>\n          ) : (\n            <div className=\"messages-container\">\n              {currentChat.messages.map((msg, index) => (\n                <div \n                  key={index} \n                  className={`message ${msg.role === 'user' ? 'user-message' : 'assistant-message'}`}\n                >\n                  <div className=\"message-content\">\n                    <div className=\"message-header\">\n                      <i className=\"material-icons\">\n                        {msg.role === 'user' ? 'person' : 'smart_toy'}\n                      </i>\n                      <span>{msg.role === 'user' ? 'You' : 'AI Assistant'}</span>\n                    </div>\n                    <MessageContent content={msg.content} />\n                  </div>\n                </div>\n              ))}\n              <div ref={messagesEndRef} />\n            </div>\n          )}\n\n          <form onSubmit={handleSendMessage} className=\"message-input-container\">\n            <input\n              type=\"text\"\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              placeholder=\"Type your message...\"\n              disabled={loading}\n            />\n            <button type=\"submit\" disabled={loading || !message.trim()}>\n              {loading ? (\n                <i className=\"material-icons rotating\">refresh</i>\n              ) : (\n                <i className=\"material-icons\">send</i>\n              )}\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n} "],"mappings":"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"},"metadata":{},"sourceType":"module"}